"use strict";var trace=function(){for(var a=0;a<arguments.length;a++)console.log(arguments[a])},Dashboard=function(a){return a.getUserProfile=function(){Registration.setupAjaxRequests(localStorage.getItem("authToken"));var b=localStorage.getItem("profileId");$.ajax({url:a.apiHost+"profiles/"+b,type:"GET",dataType:"JSON"}).done(function(b){a.showUserProfileForm(b)}).fail(function(){console.log("error")})},a.showUserProfileForm=function(b){null==b.featureImage&&(b.featureImage="https://s3.amazonaws.com/datingapp-wdi/uploads/default-blue_300x300.png");var c=Handlebars.compile($("#userEditProfileTemplate").html()),d=a.matchLocation();$("#container").html(c({editProfile:b,location:d})),$("body").on("submit","#profile-edit-form",function(b){b.preventDefault(),a.submitUserProfile()})},a.submitUserProfile=function(){Registration.setupAjaxRequests(localStorage.getItem("authToken"));var b=localStorage.getItem("profileId");$.ajax({url:a.apiHost+"profiles/"+b,type:"PUT",data:{profile:{age:$("#user-age-field").val(),bio:$("#user-bio-field").val(),seeking:$("#user-seeking-field").val(),gender:$("#user-gender-field").val(),languages:$("#user-languages-field").val(),location_id:$("#select-region").val()}}}).done(function(a){localStorage.setItem("locationId",a.location_id),router.navigate("#/dashboard",{trigger:!0})}).fail(function(){console.log("error")})},a.matchLocation=function(){var a=localStorage.getItem("locationId");switch(a){case"2":return"North Shore";case"3":return"North West";case"4":return"Metro West";case"5":return"South Shore";case"6":return"Central Mass";case"7":return"Cape Cod";default:return"Metro Boston"}},a}(Dashboard||{}),trace=function(){for(var a=0;a<arguments.length;a++)console.log(arguments[a])},Dashboard=function(a){return a.bucketUrl="https://s3.amazonaws.com/datingapp-wdi/",a.apiHost="http://sheltered-everglades-8006.herokuapp.com/",a.getAmazonJson=function(){Registration.setupAjaxRequests(localStorage.getItem("authToken")),$.ajax({url:a.apiHost+"amazon/sign_key",type:"GET"}).done(function(b){var c=Handlebars.compile($("#imageHeaderTemplate").html());$("#container").html(c({imageHeader:b})),a.submitForm(b.key)}).fail(function(a,b,c){trace(a,b,c)})},a.submitForm=function(b){var c="form#imageForm";$("body").on("submit",c,function(c,d){a.postImageRails(b),$(d).submit(),router.navigate("#/dashboard",{trigger:!0})})},a.postImageRails=function(b){Registration.setupAjaxRequests(localStorage.getItem("authToken"));var c=localStorage.getItem("profileId");$.ajax({url:a.apiHost+"profiles/"+c+"/images",type:"POST",data:{image:{url:a.bucketUrl+b,profile_id:c}}}).done(function(a){trace(a)}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})},a.getMatchesSnapshots=function(){Registration.setupAjaxRequests(localStorage.getItem("authToken"));var b=localStorage.getItem("locationId"),c=localStorage.getItem("userId");$.ajax({url:a.apiHost+"locations/"+b,type:"GET"}).done(function(b){var d=$.grep(b,function(a){return a.id!=c});d.map(function(a){null==a.featureImage&&(a.featureImage="https://s3.amazonaws.com/datingapp-wdi/uploads/default-blue_300x300.png")}),a.renderMatchImages(d)}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})},a.renderMatchImages=function(a){var b=Handlebars.compile($("#matchesTemplate").html());$("#container").html(b({snapshots:a}))},a.aMatchProfile=function(b){Registration.setupAjaxRequests(localStorage.getItem("authToken")),$.ajax({url:a.apiHost+"profiles/"+b,type:"GET"}).done(function(b){a.renderAMatchProfile(b)}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})},a.renderAMatchProfile=function(a){null===a.featureImage&&(a.featureImage="https://s3.amazonaws.com/datingapp-wdi/uploads/default-blue_300x300.png");var b=Handlebars.compile($("#matchProfileTemplate").html());$("#matchRow").html(b({matchProfile:a}))},a}(Dashboard||{}),trace=function(){for(var a=0;a<arguments.length;a++)console.log(arguments[a])},Registration=function(){var a,b,c=function(){$("#registrationForm").on("submit",d),$("#loginForm").on("submit",e),$("#signOut").on("click",g),b="http://sheltered-everglades-8006.herokuapp.com/"},d=function(a){return a.preventDefault(),localStorage.setItem("locationId",$("#user-region").val()),$.ajax({url:b+"/users",type:"POST",data:{user:{username:$("#username").val(),email:$("#email").val(),password:$("#password").val()}},complete:function(a){console.log("completing the submitRegistration ajax request",a)}}).done(h).fail(function(a){console.log(a)}),!1},e=function(a){var c;return a.preventDefault(),c=$(this),$.ajax({url:b+"/users/sign_in",type:"POST",data:c.serialize(),complete:function(a){console.log("from the complete submitlogin callback",a)}}).done(h).fail(function(a){console.log(a)}),!1},f=function(a){$.ajaxPrefilter(function(b){b.headers={},b.headers.AUTHORIZATION="Token token="+a})},g=function(b){b.preventDefault(),localStorage.removeItem("authToken"),localStorage.removeItem("userId"),localStorage.removeItem("profileId"),localStorage.removeItem("locationId"),a=void 0,console.log("User has been signed out"),location.reload(),router.navigate("/",{trigger:!0})},h=function(b){localStorage.setItem("authToken",b.token),a=b.token,f(a),localStorage.setItem("userId",b.user_id),localStorage.setItem("profileId",b.profile_id),i(localStorage.getItem("locationId")),router.navigate("#/dashboard",{trigger:!0})},i=function(a){var c=localStorage.getItem("profileId");$.ajax({url:b+"profiles/"+c,type:"PUT",data:{profile:{location_id:a}}}).done(function(a){trace(a)}).fail(function(){console.log("error")})};return{run:c,setupAjaxRequests:f}}(),trace=function(){for(var a=0;a<arguments.length;a++)console.log(arguments[a])},App=function(){var a="http://sheltered-everglades-8006.herokuapp.com/",b=Backbone.Router.extend({routes:{"":"home",home:"home",signup:"signup",signin:"signin",dashboard:"dashboard",profile:"profile","matchProfile/:id":"matchProfile",addImage:"addImage"},home:function(){$("#matchRow").empty(),$("#container").empty(),$.ajax({url:a+"profiles",type:"GET"}).done(function(a){var b=c(a.length),d=b.map(function(b){return a[b]});d.map(function(a){null==a.featureImage&&(a.featureImage="https://s3.amazonaws.com/datingapp-wdi/uploads/default-blue_300x300.png")});var e=Handlebars.compile($("#homeTemplate").html());$("#container").html(e({profiles:d}))}).fail(function(a,b,c){trace(a,b,c)}).always(function(a){trace(a)})},signup:function(){$("#matchRow").empty(),$("#container").empty().load("partials/signup.html",function(){Registration.run()})},signin:function(){$("#matchRow").empty(),$("#container").empty().load("partials/signin.html",function(){Registration.run()})},dashboard:function(){$("#container").empty(),$("#matchRow").empty().load("dashboard.html",function(){Dashboard.getMatchesSnapshots()})},profile:function(){$("#matchRow").empty(),$("#container").empty().load("partials/profile.html",function(){Dashboard.getUserProfile()})},matchProfile:function(){var a=window.location.hash,b=a.lastIndexOf("/"),c=parseInt(a.substring(b+1,a.length));$("#container").empty(),$("#matchRow").empty().load("partials/match_profile.html",function(){Dashboard.aMatchProfile(c)})},addImage:function(){$("#matchRow").empty(),$("#container").empty().load("dashboard.html",function(){Dashboard.getAmazonJson()})}}),c=function(a){for(var b,c=[],d=0;4>d;d++)b=Math.floor(Math.random()*(a-0))+0,c.indexOf()<0&&c.push(b);return c};return{Router:b}}(),router=new App.Router;Backbone.history.start(),$(document).ajaxStart(function(){$("section#ajax-preloader").fadeIn()}),$(document).ajaxComplete(function(){$("section#ajax-preloader").fadeOut(),$("section#container").fadeIn()});